§u§
````
## Installation

### System requirements

- `Nobara-42-Official-Nvidia`, a fork of Fedora Linux.
- an nvidia GPU with at least 8GB VRAM, a CUDA compute capability of at least 8.9 and support for CUDA 12.8.
- toolbox enabled
- `amd64` or `x86_64` architecture CPU
- at least 100 GB free storage in /opt
- at least 24 GB of RAM

### Increase memlock

<!-- BEGIN https://discord.com/channels/110175050006577152/906398525250760756/1348821886502441040 -->

Add (or update) the following lines to `/etc/security/limits.conf`:
```text
* soft memlock 50331648
* hard memlock 50331648
```

<!-- END https://discord.com/channels/110175050006577152/906398525250760756/1348821886502441040 -->

### System updates

Update the entire system through the `Update System` Nobara app.

### GCC

Install the gcc and gcc-c++ compilers:

```shell
sudo dnf install gcc gcc-c++
```

### Git

Install git:

```shell
sudo dnf install git
```

Clone the repository:

```shell
git clone https://github.com/redacted/maturaarbeit.git
cd maturaarbeit
```

### Python

Install Python version 3.12.10 with the following command:

```shell
sudo dnf install python3.12-0:3.12.10-1.fc42.x86_64
```

Install the Python development packages:

```shell
sudo dnf install python3.12-devel-0:3.12.10-1.fc42
```

The Python virtual environment package is also required:

```shell
sudo dnf install python3-virtualenv
```

#### Virtual environment

Create the virtual environment using the provided bash script:

```shell
./create_venv.sh
```

### CUDA

<!-- BEGIN https://github.com/ggml-org/llama.cpp/blob/master/docs/build.md -->
<!-- BEGIN https://wiki.nobaraproject.org/en/graphics/nvidia/cuda -->

Note: Make sure to use version 12.8.*, as it is required by this project.

Install the `cuda-devel` package through the `Nobara Package Manager` app.

<!-- END https://wiki.nobaraproject.org/en/graphics/nvidia/cuda -->

#### ToolBox

<!-- BEGIN https://github.com/ggml-org/llama.cpp/blob/master/docs/backend/CUDA-FEDORA.md -->

Create the toolbox environment with the following command on the host:

```shell
toolbox create --image registry.fedoraproject.org/fedora-toolbox:41 --container fedora-toolbox-41-cuda
```

Enter the toolbox with the following command on host. All following commands in this section are to be executed in the toolbox.

```shell
toolbox enter fedora-toolbox-41-cuda
```

Synchronize the DNF package manager:

```shell
sudo dnf distro-sync
```

Install development tools:

```shell
sudo dnf install @c-development @development-tools cmake
```

Install python:

```shell
sudo dnf install python3.12
```

<!-- BEGIN https://developer.nvidia.com/cuda-12-8-1-download-archive?target_os=Linux&target_arch=x86_64&Distribution=Fedora -->

Add the NVIDIA CUDA repository to DNF:

```shell
sudo dnf config-manager addrepo --from-repofile=https://developer.download.nvidia.com/compute/cuda/repos/fedora42/x86_64/cuda-fedora41.repo
```

<!-- END https://developer.nvidia.com/cuda-12-8-1-download-archive?target_os=Linux&target_arch=x86_64&Distribution=Fedora -->

Synchronize the DNF package manager again:

```shell
sudo dnf distro-sync
```

Detect if the host is supplying the nvidia driver libraries:

```shell
ls -la /usr/lib64/libcuda.so.1
```

**Begin of `libcuda.so.1` is missing**

Install the nvidia driver libraries:

```shell
sudo dnf install nvidia-driver-cuda nvidia-driver-libs nvidia-driver-cuda-libs nvidia-persistenced
```

**End of `libcuda.so.1` is missing**

**Begin of `libcuda.so.1` exists**

The toolbox RPM database has to be updated accordingly.

```shell
sudo dnf download --destdir=/tmp/nvidia-driver-libs --resolve --arch x86_64 nvidia-driver-cuda nvidia-driver-libs nvidia-driver-cuda-libs nvidia-persistenced
sudo rpm --install --verbose --hash --justdb /tmp/nvidia-driver-libs/*
```

Check if the RPM database has been updated:

```shell
sudo dnf install nvidia-driver-cuda nvidia-driver-libs nvidia-driver-cuda-libs nvidia-persistenced
```

**End of `libcuda.so.1` exists**

Install the CUDA metapackage:

```shell
sudo dnf install cuda
```

Create a profile script for CUDA:

```shell
sudo sh -c 'echo "export PATH=\$PATH:/usr/local/cuda/bin" >> /etc/profile.d/cuda.sh'
sudo chmod +x /etc/profile.d/cuda.sh
```

Source the profile script to update the environment:

```shell
source /etc/profile.d/cuda.sh
```

Verify the CUDA installation:

```shell
nvcc --version
```

The output should look similar to this:

```
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2025 NVIDIA Corporation
Built on Fri_Feb_21_20:23:50_PST_2025
Cuda compilation tools, release 12.8, V12.8.93
Build cuda_12.8.r12.8/compiler.35583870_0
```

<!-- END https://github.com/ggml-org/llama.cpp/blob/master/docs/backend/CUDA-FEDORA.md -->

### llama.cpp

Enter the CUDA toolbox:

```shell
toolbox enter fedora-toolbox-41-cuda
```

Run the llama.cpp installation script:

```shell
./install_llama_cpp.sh
```

Copy the build folder to the host system.

```shell
sudo cp -r /tmp/llama_cpp/llama.cpp/build /opt
```

Copy the llama.cpp scripts into the directory:

```shell
sudo cp /tmp/llama_cpp/llama.cpp/convert_hf_to_gguf.py /opt/build/bin/
sudo cp /tmp/llama_cpp/llama.cpp/convert_hf_to_gguf_update.py /opt/build/bin/
sudo cp /tmp/llama_cpp/llama.cpp/convert_llama_ggml_to_gguf.py /opt/build/bin/
sudo cp /tmp/llama_cpp/llama.cpp/convert_lora_to_gguf.py /opt/build/bin/
```

Exit the toolbox:

```shell
exit
```

Rename the build folder:

```shell
sudo mv /opt/build /opt/llama.cpp
```

Modify the environment variables in `~/.bashrc` by adding the following lines to the end of the file:

```bash
export PATH="/opt/llama.cpp/bin:$PATH"
export LD_LIBRARY_PATH="/opt/llama.cpp/lib:$LD_LIBRARY_PATH"
```

#### Enable shared memory (optional)

To enable shared memory support for llama.cpp, add the following line to the end of `~/.bashrc`:

```bash
export GGML_CUDA_ENABLE_UNIFIED_MEMORY=1
```

<!-- END https://github.com/ggml-org/llama.cpp/blob/master/docs/build.md -->
````
Write an install script for this. Check if the system has the minimum requirements. Caution with the toolbox environment.
§a§
Here's a comprehensive install script based on your documentation:

```bash
#!/bin/bash

# Install script for maturaarbeit project
# Requires Nobara-42-Official-Nvidia

set -e  # Exit on error

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Logging functions
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Check if running as root
check_not_root() {
    if [[ $EUID -eq 0 ]]; then
        log_error "This script should not be run as root. Please run as a regular user."
        exit 1
    fi
}

# Check if we're in a toolbox
check_not_in_toolbox() {
    if [[ -n "${TOOLBOX_PATH}" ]] || [[ -f "/run/.toolboxenv" ]]; then
        log_error "This script should not be run inside a toolbox. Please run on the host system."
        exit 1
    fi
}

# Check system requirements
check_system_requirements() {
    log_info "Checking system requirements..."

    # Check OS
    if [[ ! -f /etc/os-release ]]; then
        log_error "Cannot determine OS version"
        exit 1
    fi

    source /etc/os-release
    if [[ "$NAME" != *"Nobara"* ]]; then
        log_warning "This script is designed for Nobara Linux. Current OS: $NAME"
        read -p "Continue anyway? (y/N): " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            exit 1
        fi
    fi

    # Check architecture
    ARCH=$(uname -m)
    if [[ "$ARCH" != "x86_64" ]] && [[ "$ARCH" != "amd64" ]]; then
        log_error "Unsupported architecture: $ARCH. Required: x86_64 or amd64"
        exit 1
    fi

    # Check RAM
    TOTAL_RAM_KB=$(grep MemTotal /proc/meminfo | awk '{print $2}')
    TOTAL_RAM_GB=$((TOTAL_RAM_KB / 1024 / 1024))
    if [[ $TOTAL_RAM_GB -lt 24 ]]; then
        log_error "Insufficient RAM: ${TOTAL_RAM_GB}GB. Required: 24GB minimum"
        exit 1
    fi
    log_success "RAM check passed: ${TOTAL_RAM_GB}GB"

    # Check storage in /opt
    if [[ ! -d "/opt" ]]; then
        sudo mkdir -p /opt
    fi
    AVAILABLE_SPACE=$(df /opt | tail -1 | awk '{print $4}')
    AVAILABLE_SPACE_GB=$((AVAILABLE_SPACE / 1024 / 1024))
    if [[ $AVAILABLE_SPACE_GB -lt 100 ]]; then
        log_error "Insufficient storage in /opt: ${AVAILABLE_SPACE_GB}GB. Required: 100GB minimum"
        exit 1
    fi
    log_success "Storage check passed: ${AVAILABLE_SPACE_GB}GB available in /opt"

    # Check NVIDIA GPU
    if ! command -v nvidia-smi &> /dev/null; then
        log_error "nvidia-smi not found. Please ensure NVIDIA drivers are installed."
        exit 1
    fi

    # Check VRAM
    VRAM_MB=$(nvidia-smi --query-gpu=memory.total --format=csv,noheader,nounits | head -1)
    VRAM_GB=$((VRAM_MB / 1024))
    if [[ $VRAM_GB -lt 8 ]]; then
        log_error "Insufficient VRAM: ${VRAM_GB}GB. Required: 8GB minimum"
        exit 1
    fi
    log_success "VRAM check passed: ${VRAM_GB}GB"

    # Check toolbox
    if ! command -v toolbox &> /dev/null; then
        log_error "toolbox command not found. Please install toolbox."
        exit 1
    fi
    log_success "toolbox found"

    log_success "All system requirements met"
}

# Increase memlock
setup_memlock() {
    log_info "Setting up memlock limits..."

    LIMITS_FILE="/etc/security/limits.conf"
    if ! grep -q "memlock 50331648" "$LIMITS_FILE"; then
        echo "* soft memlock 50331648" | sudo tee -a "$LIMITS_FILE" > /dev/null
        echo "* hard memlock 50331648" | sudo tee -a "$LIMITS_FILE" > /dev/null
        log_success "Memlock limits configured"
    else
        log_info "Memlock limits already configured"
    fi
}

# System updates
update_system() {
    log_info "Please update your system through the 'Update System' Nobara app before continuing."
    read -p "Have you updated your system? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        log_warning "Please update your system and run this script again."
        exit 1
    fi
}

# Install GCC
install_gcc() {
    log_info "Installing GCC compilers..."
    sudo dnf install -y gcc gcc-c++
    log_success "GCC installed"
}

# Install Git and clone repository
setup_git() {
    log_info "Installing Git..."
    sudo dnf install -y git

    if [[ ! -d "maturaarbeit" ]]; then
        log_info "Cloning repository..."
        git clone https://github.com/redacted/maturaarbeit.git
        log_success "Repository cloned"
    else
        log_info "Repository already exists"
    fi

    cd maturaarbeit
}

# Install Python
install_python() {
    log_info "Installing Python 3.12.10..."
    sudo dnf install -y python3.12-0:3.12.10-1.fc42.x86_64
    sudo dnf install -y python3.12-devel-0:3.12.10-1.fc42
    sudo dnf install -y python3-virtualenv
    log_success "Python installed"

    # Create virtual environment
    if [[ -f "./create_venv.sh" ]]; then
        log_info "Creating virtual environment..."
        ./create_venv.sh
        log_success "Virtual environment created"
    else
        log_warning "create_venv.sh not found. Please create it manually."
    fi
}

# Install CUDA on host
install_cuda_host() {
    log_info "Installing CUDA on host..."
    log_info "Please install the 'cuda-devel' package through the 'Nobara Package Manager' app."
    log_info "Make sure to use version 12.8.*"
    read -p "Have you installed cuda-devel? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        log_warning "Please install cuda-devel and run this script again."
        exit 1
    fi
}

# Setup toolbox for CUDA
setup_cuda_toolbox() {
    log_info "Setting up CUDA toolbox..."

    TOOLBOX_NAME="fedora-toolbox-41-cuda"

    # Create toolbox if it doesn't exist
    if ! toolbox list | grep -q "$TOOLBOX_NAME"; then
        log_info "Creating toolbox container..."
        toolbox create --image registry.fedoraproject.org/fedora-toolbox:41 --container "$TOOLBOX_NAME"
        log_success "Toolbox container created"
    else
        log_info "Toolbox container already exists"
    fi

    # Create script to run inside toolbox
    cat > /tmp/cuda_toolbox_setup.sh << 'EOF'
#!/bin/bash
set -e

echo "[INFO] Setting up CUDA environment in toolbox..."

# Synchronize DNF
sudo dnf distro-sync -y

# Install development tools
sudo dnf install -y @c-development @development-tools cmake

# Install Python
sudo dnf install -y python3.12

# Add NVIDIA CUDA repository
sudo dnf config-manager addrepo --from-repofile=https://developer.download.nvidia.com/compute/cuda/repos/fedora42/x86_64/cuda-fedora41.repo

# Synchronize DNF again
sudo dnf distro-sync -y

# Check for libcuda.so.1
if [[ -f "/usr/lib64/libcuda.so.1" ]]; then
    echo "[INFO] libcuda.so.1 exists, updating RPM database..."
    sudo dnf download --destdir=/tmp/nvidia-driver-libs --resolve --arch x86_64 nvidia-driver-cuda nvidia-driver-libs nvidia-driver-cuda-libs nvidia-persistenced
    sudo rpm --install --verbose --hash --justdb /tmp/nvidia-driver-libs/*
    sudo dnf install -y nvidia-driver-cuda nvidia-driver-libs nvidia-driver-cuda-libs nvidia-persistenced
else
    echo "[INFO] Installing nvidia driver libraries..."
    sudo dnf install -y nvidia-driver-cuda nvidia-driver-libs nvidia-driver-cuda-libs nvidia-persistenced
fi

# Install CUDA metapackage
sudo dnf install -y cuda

# Create profile script for CUDA
sudo sh -c 'echo "export PATH=\$PATH:/usr/local/cuda/bin" >> /etc/profile.d/cuda.sh'
sudo chmod +x /etc/profile.d/cuda.sh

# Source the profile script
source /etc/profile.d/cuda.sh

# Verify CUDA installation
nvcc --version

echo "[SUCCESS] CUDA toolbox setup complete"
EOF

    chmod +x /tmp/cuda_toolbox_setup.sh

    log_info "Running CUDA setup inside toolbox..."
    toolbox run --container "$TOOLBOX_NAME" /tmp/cuda_toolbox_setup.sh

    log_success "CUDA toolbox setup complete"
}

# Install llama.cpp
install_llama_cpp() {
    log_info "Installing llama.cpp..."

    TOOLBOX_NAME="fedora-toolbox-41-cuda"

    if [[ ! -f "./install_llama_cpp.sh" ]]; then
        log_error "install_llama_cpp.sh not found. Please ensure it exists in the current directory."
        exit 1
    fi

    # Copy script to tmp and run in toolbox
    cp ./install_llama_cpp.sh /tmp/
    chmod +x /tmp/install_llama_cpp.sh

    log_info "Running llama.cpp installation in toolbox..."
    toolbox run --container "$TOOLBOX_NAME" /tmp/install_llama_cpp.sh

    # Copy build folder to host
    log_info "Copying llama.cpp build to host system..."
    sudo rm -rf /opt/llama.cpp
    toolbox run --container "$TOOLBOX_NAME" sudo cp -r /tmp/llama_cpp/llama.cpp/build /tmp/llama_cpp_build
    sudo cp -r /tmp/llama_cpp_build /opt/build

    # Copy scripts
    log_info "Copying llama.cpp scripts..."
    toolbox run --container "$TOOLBOX_NAME" sudo cp /tmp/llama_cpp/llama.cpp/convert_hf_to_gguf.py /tmp/llama_cpp_build/bin/
    toolbox run --container "$TOOLBOX_NAME" sudo cp /tmp/llama_cpp/llama.cpp/convert_hf_to_gguf_update.py /tmp/llama_cpp_build/bin/
    toolbox run --container "$TOOLBOX_NAME" sudo cp /tmp/llama_cpp/llama.cpp/convert_llama_ggml_to_gguf.py /tmp/llama_cpp_build/bin/
    toolbox run --container "$TOOLBOX_NAME" sudo cp /tmp/llama_cpp/llama.cpp/convert_lora_to_gguf.py /tmp/llama_cpp_build/bin/

    sudo cp /tmp/llama_cpp_build/bin/convert_*.py /opt/build/bin/ 2>/dev/null || true

    # Rename build folder
    sudo mv /opt/build /opt/llama.cpp

    log_success "llama.cpp installed to /opt/llama.cpp"
}

# Setup environment variables
setup_environment() {
    log_info "Setting up environment variables..."

    BASHRC="$HOME/.bashrc"

    # Add PATH and LD_LIBRARY_PATH
    if ! grep -q "/opt/llama.cpp/bin" "$BASHRC"; then
        echo 'export PATH="/opt/llama.cpp/bin:$PATH"' >> "$BASHRC"
        echo 'export LD_LIBRARY_PATH="/opt/llama.cpp/lib:$LD_LIBRARY_PATH"' >> "$BASHRC"
        log_success "Environment variables added to ~/.bashrc"
    else
        log_info "Environment variables already configured"
    fi

    # Optional: Enable shared memory
    read -p "Enable shared memory support for llama.cpp? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        if ! grep -q "GGML_CUDA_ENABLE_UNIFIED_MEMORY" "$BASHRC"; then
            echo 'export GGML_CUDA_ENABLE_UNIFIED_MEMORY=1' >> "$BASHRC"
            log_success "Shared memory support enabled"
        else
            log_info "Shared memory support already enabled"
        fi
    fi
}

# Cleanup
cleanup() {
    log_info "Cleaning up temporary files..."
    rm -f /tmp/cuda_toolbox_setup.sh
    rm -f /tmp/install_llama_cpp.sh
    sudo rm -rf /tmp/llama_cpp_build
    log_success "Cleanup complete"
}

# Main installation function
main() {
    log_info "Starting maturaarbeit installation..."

    check_not_root
    check_not_in_toolbox
    check_system_requirements

    setup_memlock
    update_system
    install_gcc
    setup_git
    install_python
    install_cuda_host
    setup_cuda_toolbox
    install_llama_cpp
    setup_environment
    cleanup

    log_success "Installation complete!"
    log_info "Please restart your terminal or run 'source ~/.bashrc' to load the new environment variables."
    log_info "You can verify the installation by running: llama-cli --version"
}

# Run main function
main "$@"
```

This script includes:

1. **System requirement checks**: Verifies OS, architecture, RAM, storage, NVIDIA GPU, and toolbox availability
2. **Error handling**: Uses `set -e` and proper error checking throughout
3. **Toolbox safety**: Ensures the script isn't run inside a toolbox
4. **Interactive prompts**: For system updates and optional features
5. **Comprehensive logging**: Color-coded output for different message types
6. **Cleanup**: Removes temporary files after installation

**Important notes:**

- Run this script from the directory where you want to clone the repository
- Make sure you have sudo privileges
- The script will prompt you to update your system through the Nobara app
- It will also prompt you to install cuda-devel through the Package Manager
- The script assumes `create_venv.sh` and `install_llama_cpp.sh` exist in your repository

Make the script executable and run it:

```bash
chmod +x install.sh
./install.sh
```
